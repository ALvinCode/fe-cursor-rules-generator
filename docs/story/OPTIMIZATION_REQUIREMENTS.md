# 规则生成优化需求分析

> 用户提出的4个优化需求详细分析

---

## 📋 需求列表

### 需求 1：最佳实践补充机制

**需求描述**：
- 最佳实践不只是应用于兜底
- 在分析项目的所有实际情况后
- 结合最匹配的技术栈的 cursor rules
- 补充该项目实际存在或使用，但没有被声明进 cursor rules 中的规则

**当前问题**：
- 框架匹配只用于 Persona 和格式提示
- 没有从 awesome-cursorrules 中提取实际的最佳实践内容
- 没有对比项目实际情况与最佳实践，找出缺失的规则

**需要实现**：
1. 从匹配的 awesome-cursorrules 规则文件中提取最佳实践
2. 对比项目实际情况，找出项目已使用但未在规则中声明的实践
3. 将这些实践补充到生成的规则中

---

### 需求 2：建议分离机制

**需求描述**：
- 对于推荐建议，不要直接加在 rules 中
- 优先按照 GitHub 获取的最佳实践的 rules 来
- 如果有建议，明确在生成之后，让用户确认

**当前问题**：
- 规则文件中直接包含"短期建议"和"长期建议"
- 这些建议混在规则中，不够清晰
- 用户无法选择是否采纳建议

**需要实现**：
1. 将建议从规则文件中分离出来
2. 在生成完成后，单独列出建议供用户确认
3. 用户确认后再决定是否添加到规则中

---

### 需求 3：禁止生成无意义的 MD 文件

**需求描述**：
- 禁止使用 cursor rules 生成代码后，在项目中增加过程记录
- 禁止生成总结类的无意义的 .md 文件
- 禁止主动添加与项目无关的 md 文件

**当前问题**：
- 需要检查是否有生成 MD 文件的逻辑
- 需要在规则中明确禁止这种行为

**需要实现**：
1. 在生成的规则中添加明确的禁止条款
2. 检查代码中是否有生成 MD 文件的逻辑（如果有需要移除）

---

### 需求 4：编码习惯占比判断

**需求描述**：
- 如果某种开发编码习惯在整个项目内的占比是 50% 左右
- 不是绝对普适的，要提出，并让用户做选择
- 需要梳理一个合适的判断百分比

**当前问题**：
- 没有明确的占比阈值
- 没有对模糊习惯的处理机制
- 需要用户确认的机制不完善

**需要实现**：
1. 定义占比阈值：
   - 小于 X%：不考虑（不是编码习惯）
   - X% - Y%：需要用户确认（模糊习惯）
   - 大于 Y%：默认采用（明确的编码习惯）
2. 在分析时识别模糊习惯
3. 在生成规则时列出需要确认的习惯

---

## ❓ 需要确认的问题

### 问题 1：最佳实践补充的范围

**问题**：从 awesome-cursorrules 中提取最佳实践时，应该提取哪些内容？

**选项**：
- A. 只提取与项目技术栈直接相关的最佳实践
- B. 提取所有通用最佳实践（代码风格、错误处理、性能优化等）
- C. 提取匹配框架规则文件中的所有最佳实践

**建议**：选项 C - 提取匹配框架规则文件中的所有最佳实践，然后与项目实际情况对比

---

### 问题 2：建议的展示方式

**问题**：建议应该如何展示给用户？

**选项**：
- A. 在生成规则后的输出中列出，用户通过命令行确认
- B. 生成一个独立的 `suggestions.md` 文件，用户手动确认
- C. 在输出中列出，并提供工具让用户选择采纳哪些建议

**建议**：选项 A - 在输出中列出，用户通过交互确认（但 MCP Server 可能不支持交互，需要改为在输出中明确列出，用户手动决定）

---

### 问题 3：占比阈值定义

**问题**：编码习惯占比的判断阈值应该是多少？

**当前思考**：
- **< 30%**：不考虑（不是编码习惯，可能是偶然使用）
- **30% - 70%**：需要用户确认（模糊习惯，项目中有多种方式）
- **> 70%**：默认采用（明确的编码习惯）

**需要确认**：
- 这个阈值是否合理？
- 是否需要针对不同类型的习惯设置不同的阈值？
  - 代码风格（变量声明、函数风格等）：可能需要更高的阈值（> 80%）
  - 错误处理方式：可能需要较低的阈值（> 60%）
  - 文件组织方式：可能需要更高的阈值（> 85%）

---

### 问题 4：MD 文件检查范围

**问题**：需要检查哪些地方可能生成 MD 文件？

**需要检查**：
- [ ] 规则生成器本身是否生成 MD 文件（除了 instructions.md）
- [ ] 生成的规则内容中是否有指导生成 MD 文件的条款
- [ ] 是否有其他模块会生成 MD 文件

---

### 问题 5：最佳实践提取的实现方式

**问题**：如何从 awesome-cursorrules 中提取最佳实践？

**选项**：
- A. 直接读取已提取的规则文件内容，解析出最佳实践
- B. 维护一个最佳实践数据库，根据框架匹配查询
- C. 实时从 GitHub 获取（不推荐，太慢）

**建议**：选项 A - 解析已提取的规则文件，提取结构化内容

---

### 问题 6：建议的分类

**问题**：建议应该如何分类？

**选项**：
- A. 按优先级分类（高、中、低）
- B. 按类型分类（代码风格、架构、性能、安全等）
- C. 按影响范围分类（全局、模块、文件）

**建议**：选项 B + C - 按类型和影响范围分类，便于用户选择

---

## 🎯 实施计划

### 阶段 1：需求确认
- [ ] 确认占比阈值
- [ ] 确认建议展示方式
- [ ] 确认最佳实践提取范围

### 阶段 2：核心功能实现
- [ ] 实现最佳实践提取和对比机制
- [ ] 实现建议分离机制
- [ ] 实现占比判断和用户确认机制
- [ ] 添加禁止生成 MD 文件的规则

### 阶段 3：测试和优化
- [ ] 测试各种场景
- [ ] 优化阈值和判断逻辑
- [ ] 更新文档

---

## 📝 待确认清单

请确认以下问题：

1. **占比阈值**：
   - < 30%：不考虑
   - 30% - 70%：需要用户确认
   - > 70%：默认采用
   - 是否需要针对不同类型设置不同阈值？

2. **建议展示方式**：
   - 在输出中列出，用户手动决定是否采纳？
   - 还是需要其他方式？

3. **最佳实践提取范围**：
   - 提取匹配框架规则文件中的所有最佳实践？
   - 还是只提取特定类型的最佳实践？

4. **建议分类方式**：
   - 按类型分类（代码风格、架构、性能等）？
   - 按影响范围分类（全局、模块、文件）？
   - 还是两者结合？

5. **MD 文件检查**：
   - 除了 instructions.md，是否还有其他需要保留的 MD 文件生成？

---

**等待用户确认后开始实施...**

